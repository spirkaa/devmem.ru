- hosts: all
  gather_facts: no

  vars:
    ct_registry: "{{ lookup('env','REGISTRY') }}"
    ct_name: "{{ lookup('env','IMAGE_NAME') }}"
    ct_tag: "{{ lookup('env','GIT_COMMIT') }}"
    ct_image: "{{ ct_registry }}/{{ ct_name }}:{{ ct_tag }}"
    ct_port: 8088

  tasks:
    - name: "{{ ct_name }} - start container"
      docker_container:
        name: "{{ ct_name }}"
        image: "{{ ct_image }}"
        pull: yes
        ports:
          - "{{ ct_port }}:80"
        restart_policy: unless-stopped
        state: started
